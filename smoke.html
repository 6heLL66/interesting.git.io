<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Smoke</title>
</head>
<body>
	<canvas  style="margin:0;" id="root" width="800px" height="800px"></canvas>

	<script type="text/javascript">
		var canvas = document.getElementById('root'),
			ctx = canvas.getContext("2d"),
			myImageData = ctx.createImageData(800, 800);

		
 		var pixels = [];

		function setPixels(posX,posY,rgba){
			
				var vel =  Math.random() * (0 - -2) + -2,
					ang = Math.random() * (2 - 1) + 1;
					
				
				var obj = {
					"color" : rgba,
					"speedY" : Math.sin(ang)*vel,
					"speedX" : Math.cos(ang)*vel,
					"posX" : posX,
					"posY" : posY,
					"lifeTime" : Math.round(Math.random() * (3000 - 1500) - 1500),
					"time" : 0
				}
				console.log(obj.color);
				pixels.push(obj);
				//console.log(pixels);
				
			
			

		}
		function updatePixels(){
			
			for(let i = 0;i<pixels.length;i++){
				
				pixels[i].posY = pixels[i].posY + pixels[i].speedY;
				pixels[i].posX = pixels[i].posX + pixels[i].speedX;
				pixels[i].time += 20;
				if(pixels[i].time > pixels[i].lifeTime)pixels[i].color[3] = 0;
				
			
			}
			
			drawPixels();
		}
		function drawPixels(){
			canvas.width = canvas.width;
			myImageData = ctx.createImageData(800, 800);

			for(let i = 0;i<pixels.length;i++){
				let color = pixels[i].color;
				    
				let x = Math.round(pixels[i].posX),
					y = Math.round(pixels[i].posY);
				
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 )] = color[0];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +1] = color[1];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +2] = color[2];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +3] = color[3];
			}
			
			ctx.putImageData(myImageData, 0, 0);
		}
		canvas.onclick = function(e){
			var posY = e.clientY,
				posX = e.clientX;
			for(let i =0;i<200;i++){
				rgba = [Math.round(Math.random()*255),Math.round(Math.random() * 255),Math.round(Math.random()*255),Math.round(Math.random() * 255 )];
			setPixels(posX,posY,rgba);
			
			}
			drawPixels();
			up = setInterval(updatePixels,20);
			setTimeout(clearPixels,3000);
			
			
			
		}
		function clearPixels () {
			canvas.width = canvas.width;
			myImageData = ctx.createImageData(800, 800);
			pixels = [];
			clearInterval(up);
		}
		
	</script>
</body>
</html>
