<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Smoke</title>
</head>
<body>
	<canvas  style="margin:0;" id="root" width="800px" height="800px"></canvas>

	<script type="text/javascript">
		var canvas = document.getElementById('root'),
			ctx = canvas.getContext("2d"),
			myImageData = ctx.createImageData(800, 800);

		
 		var pixels = [];

		function setPixels(posX,posY,min,max,n){
			for(let i = 0;i<n;i++){
				var vel =  Math.random() * (0.1 - -2) + -2,
					ang = Math.random() * (-5.2 - -4.2) + -4.2,
					rgba = [Math.round(Math.random() * (max.r - min.r) + min.r),Math.round(Math.random() * (max.g - min.g) + min.g),Math.round(Math.random() * (max.b - min.b) + min.b),Math.round(Math.random() * (max.a - min.a) + min.a)];
					
				
				var obj = {
					"color" : rgba,
					"speedY" : Math.sin(ang)*vel,
					"speedX" : Math.cos(ang)*vel,
					"posX" : posX,
					"posY" : posY,
					"lifeTime" : Math.round(Math.random() * (max.lifetime - min.lifetime) + min.lifetime),
					"time" : 0,
					"alive" : true
				}
				
				pixels.push(obj);
				
			}
				
			
			

		}
		function updatePixels(){
			
			for(let i = 0;i<pixels.length;i++){
				if(pixels[i].alive == true){
					if(pixels[i].time > pixels[i].lifeTime)pixels[i].alive = false;
					pixels[i].posY = pixels[i].posY + pixels[i].speedY;
					pixels[i].posX = pixels[i].posX + pixels[i].speedX;
					pixels[i].time += 20;
				}

				
				
			
			}
			
			drawPixels();
		}
		function drawPixels(){
			canvas.width = canvas.width;
			myImageData = ctx.createImageData(800, 800);

			for(let i = 0;i<pixels.length;i++){
				if(pixels[i].alive == false)continue;
				let color = pixels[i].color;
				    
				let x = Math.round(pixels[i].posX),
					y = Math.round(pixels[i].posY);
				
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 )] = color[0];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +1] = color[1];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +2] = color[2];
				myImageData.data[ (y*canvas.width*4)+ ((x)*4 ) +3] = color[3];
			}
			
			ctx.putImageData(myImageData, 0, 0);
		}
		up = setInterval(updatePixels,20);
		canvas.onclick = function(e){
			var posY = e.clientY,
				posX = e.clientX,
				n = 200,
				min = {
					"r" : 0,
					"g" : 0,
					"b" : 0,
					"a" : 0,
					"lifetime" : 1500
				},
				max = {
					"r" : 255,
					"g" : 255,
					"b" : 255,
					"a" : 255,
					"lifetime" : 2500
				}
			
				
			setPixels(posX,posY,min,max,n);
			
			
			drawPixels();
			
			
			
			
			
		}
		function clearPixels () {
			canvas.width = canvas.width;
			myImageData = ctx.createImageData(800, 800);
			pixels = [];
			clearInterval(up);
		}
		
	</script>
</body>
</html>
